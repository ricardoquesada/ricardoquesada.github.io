<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Cocos2d-X | RETRO.MOE</title>
<meta name="keywords" content="">
<meta name="description" content="From Commodore 64 to the present: a developer&#39;s journey">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/tag/cocos2d-x/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fcb3718b9739f6b39cc36096f68dccc8a7e0d3e24fc6b09c575e0c25ec8f35b2.css" integrity="sha256-/LNxi5c59rOcw2CW9o3MyKfg0&#43;JPxrCcV14MJeyPNbI=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tag/cocos2d-x/feed.xml">
<link rel="alternate" hreflang="en" href="http://localhost:1313/tag/cocos2d-x/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">

</head>

<body class="list" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="RETRO.MOE (Alt + H)">RETRO.MOE</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/unijoysticle/" title="Unijoysticle‚Ñ¢">
                    <span>Unijoysticle‚Ñ¢</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/unijoysticle2/" title="Unijoysticle‚Ñ¢ 2">
                    <span>Unijoysticle‚Ñ¢ 2</span>
                </a>
            </li>
            <li>
                <a href="https://www.tindie.com/stores/riq/" title="Store">
                    <span>Store</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="üîç">
                    <span>üîç</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/tag/">Tag</a></div>
  <h1>
    Cocos2d-X
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Integrating LiquidFun with Cocos2d-x: Part II
    </h2>
  </header>
  <div class="entry-content">
    <p>In Part I I described to how integrated LiquidFun with Cocos2d-x. In this part (part II) I‚Äôll describe how to render the particles using a basic water effect.
Part I uses just one glDrawArrays(GL_POINTS, 0, total); to draw the particles. And although that works to draw ‚Äúparticles‚Äù, it is not enough to draw ‚Äúwater‚Äù.
Drawing ‚Äúwater‚Äù requires a more complex rendering algorithm, like the one used in this example. And implementing an algorithm similar that one is what this article describes.
The algorithm works more or less like this:
Choose a white circle and blur it. You can blur the circle at runtime Or you can blur it off-line. Create an a new frame-buffer (think of a clean off-screen buffer where you can render whatever you want) Render the particles into the newly created frame-buffer using the blurred circle Now render the frame-buffer into the main color-buffer using a threshold. The threshold could be something like this: If pixel.r &lt; 0.1, discard the pixel (the pixel won‚Äôt be drawn) If pixel.r &lt; 0.2, draw a blue pixel (for the border, although this is optional) else draw a white pixel (the inner part of the water) How to do it using Cocos2d-x and LiquidFun Let‚Äôs take the LFParticleSystemNode from Part I, and ‚Äúevolve‚Äù it:
The first thing to do is to add the ‚Äúoff-screen‚Äù frame-buffer into the LFParticleSystemNode class. In Cocos2d-x, the ‚Äúoff-screen‚Äù buffers are created with the RenderTexture class. Example:
[code language=‚Äúcpp‚Äù] bool LFParticleSystemNode::init(b2ParticleSystem* particleSystem, float ratio) { ‚Ä¶ // create an off-screen frame-buffer with the size of the screen auto s = Director::getInstance()-&gt;getWinSize(); _renderTexture = cocos2d::RenderTexture::create(s.width, s.height, Texture2D::PixelFormat::RGBA8888); this-&gt;addChild(_renderTexture); _renderTexture-&gt;setAnchorPoint(Point::ANCHOR_MIDDLE); _renderTexture-&gt;setPosition(Point(s.width/2, s.height/2));
// Change the default shader. Use a the threshold shader auto program = GLProgram::createWithByteArrays(_renderTextureShaderVert, _renderTextureShaderFrag); auto programState = GLProgramState::getOrCreateWithGLProgram(program); programState-&gt;setUniformFloat(‚Äúu_threshold_discard‚Äù, 0.15); programState-&gt;setUniformFloat(‚Äúu_threshold_border‚Äù, 0.3);
‚Ä¶ } [/code]
And, as mentioned earlier, the RenderTexture (the off-screen frame-buffer) needs a shader with a threshold. The threshold shader should look like the following:
[code language=‚Äúcpp‚Äù] varying vec4 v_fragmentColor; varying vec2 v_texCoord; uniform float u_threshold_discard; uniform float u_threshold_border;
void main() { vec4 color = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); if( color.r &lt; u_threshold_discard) // black or discard color = vec4(0,0,0,0); else if( color.r &lt; u_threshold_border) // blue for the border color = vec4(0.2,0.2,0.9,1); else // white for the center color = vec4(1,1,1,1); gl_FragColor = color; } [/code]
The values u_threshold_discard, and u_threshold_border are defined at runtime. In the example, they are set at 0.15 and 0.3 respectively.
The next thing to do is, to render the particles in the RenderTexture.
[code language=‚Äúcpp‚Äù]void LFParticleSystemNode::draw(Renderer *renderer, const Mat4 &amp;transform, uint32_t transformFlags) { // tell RenderTexture to ‚Äúcapture‚Äù the particles _renderTexture-&gt;beginWithClear(0,0,0,0);
_customCommand.init(_globalZOrder); _customCommand.func = CC_CALLBACK_0(LFParticleSystemNode::onDraw, this, transform, transformFlags); renderer-&gt;addCommand(&amp;_customCommand);
// tell RenderTexture to stop ‚Äúcapturing‚Äù the particles _renderTexture-&gt;end(); } [/code]
The result is the following </p>
  </div>
  <footer class="entry-footer"><span title='2014-07-30 20:45:00 +0000 +0000'>July 30, 2014</span>&nbsp;¬∑&nbsp;4 min&nbsp;¬∑&nbsp;ricardoquesada</footer>
  <a class="entry-link" aria-label="post link to Integrating LiquidFun with Cocos2d-x: Part II" href="http://localhost:1313/2014/07/30/integrating-liquidfun-with-cocos2d-x-part-ii/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Integrating LiquidFun with Cocos2d-x: Part I
    </h2>
  </header>
  <div class="entry-content">
    <p>[caption id=&#34;&#34; align=‚Äúalignnone‚Äù width=‚Äú400‚Äù] LiquidFun Testbed &#43; Cocos2d-x[/caption]
From LiquidFun‚Äôs site:
Based on Box2d, LiquidFun features particle-based fluid simulation. Game developers can use it for new game mechanics and add realistic physics to game play. Designers can use the library to create beautiful fluid interactive experiences.
Basically LiquidFun is Box2d plus an extension to simulate fluids using a particle system. To test it, download and install the official LiquidFun - Testbed, and LiquidFun - EyeCandy for Android.
Cocos2d-x already has Box2d integration, so in order to integrate Cocos2d-x with LiquidFun, we only need to integrate this new class: b2ParticleSystem.
LiquidFun‚Äôs b2ParticleSystem I‚Äôm not going to describe how to use LiquidFun (for that, read its programmers guide). Instead, I‚Äôm going to describe how to integrate b2ParticleSystem in Cocos2d-x (also applicable to any other game engine).
For the integration, what we need is a Cocos2d-x node that knows how to render a b2ParticleSystem. And b2ParticleSystem has these 4 useful methods:
[code language=‚Äúcpp‚Äù] class b2ParticleSystem { ‚Ä¶ // Get the number of particles. int32 GetParticleCount() const;
// Get the particle radius. float32 GetRadius() const;
// Get the position of each particle in Box2d‚Äôs coordinate system // Array is length GetParticleCount() b2Vec2* GetPositionBuffer();
// Get the color of each particle in RGBA Uint8 format. // Array is length GetParticleCount() b2ParticleColor* GetColorBuffer(); }; [/code]
Ideally we should be able to reuse cocos2d::ParticleSystemQuad for the rendering, but we can‚Äôt because:
cocos2d::ParticleSystemQuad doesn‚Äôt support changing the attractor (this is a design bug, we need to fix it). A nil attractor would be needed for this case. ParticleSystemQuad works with Quads, and not Points. And even if Points were supported (like in Cocos2d-x v1), it wouldn‚Äôt work because the points and colors should be in an interleaved array. The other issue is the conversion between Box2d and Cocos2d-x coordinate system, but it would be easy to fix. </p>
  </div>
  <footer class="entry-footer"><span title='2014-04-23 21:51:26 +0000 +0000'>April 23, 2014</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;ricardoquesada</footer>
  <a class="entry-link" aria-label="post link to Integrating LiquidFun with Cocos2d-x: Part I" href="http://localhost:1313/2014/04/23/integrating-liquidfun-with-cocos2d-x-part-i/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Vistual Studio: First steps
    </h2>
  </header>
  <div class="entry-content">
    <p>Goals Compile and run cocos2d-x tests on the emulator Set a breakpoint in Visual Studio. Running cpp-test on the Emulator 1. Download cocos2d-x v3.0 2. Unzip it and then go to cocos2d-x/build directory
$ cd cocos2d-x/build 3. Open cocos2d-wp8.vc2012.sln with Visual Studio
$ start cocos2d-wp8.vc2012.sln 4. Set cpp-tests (Windows Phone Silverlight 8) as the default project:
Go to the Solution Explorer Right click on cpp-tests (Windows Phone Silverlight 8) Click on Set as StartUp Project 5. Run cpp-tests on the Emulator
Press the Emulator 8.1 WVGA 4 inch button If an Hyper-V error appears, then you have to enable Hyper-V: Enable Hyper-V on the BIOS And then enable Hyper-V on Windows 8.1 Pro (it won‚Äôt work on the ‚ÄòRegular‚Äô edition). 6. If the following Dialog pops-up, just press Retry:
And that‚Äôs all. You should see the cpp-tests running on the Emulator:
</p>
  </div>
  <footer class="entry-footer"><span title='2014-04-11 02:50:07 +0000 +0000'>April 11, 2014</span>&nbsp;¬∑&nbsp;2 min&nbsp;¬∑&nbsp;ricardoquesada</footer>
  <a class="entry-link" aria-label="post link to Vistual Studio: First steps" href="http://localhost:1313/2014/04/10/vistual-studio-first-steps/"></a>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
